<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é†«é™¢è—¥å¸«å°ˆç”¨ - å…¬è²»ç–«è‹—æ±ºç­–åƒè€ƒ</title>
    <style>
        :root {
            --primary: #007bff; --primary-dark: #0056b3;
            --secondary: #6c757d;
            --success: #28a745; --success-bg: #e6fffa;
            --warning: #856404; --warning-bg: #fff3cd;
            --danger: #dc3545; --danger-bg: #fff5f5;
            --light: #f8f9fa;
        }
        body { font-family: "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; }
        
        /* Header & Tabs */
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        .header h2 { margin: 0; font-size: 1.5rem; }
        .header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; }
        
        .tabs { display: flex; background: #e9ecef; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: transparent; cursor: pointer; font-size: 1.1rem; font-weight: bold; color: var(--secondary); border-bottom: 4px solid transparent; transition: 0.2s; }
        .tab-btn:hover { background: #dee2e6; }
        .tab-btn.active { background: white; color: var(--primary); border-bottom-color: var(--primary); }

        /* Content Sections */
        .content-section { padding: 25px; display: none; }
        .content-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Form Elements */
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #495057; }
        input[type="date"], input[type="number"], select { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; box-sizing: border-box; transition: 0.2s; }
        input:focus, select:focus { border-color: var(--primary); outline: none; }
        
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
        .checkbox-item { background: var(--light); padding: 10px; border-radius: 8px; display: flex; align-items: center; cursor: pointer; border: 1px solid #dee2e6; }
        .checkbox-item:hover { border-color: var(--primary); }
        .checkbox-item input { width: auto; margin-right: 10px; transform: scale(1.2); }

        .btn-query { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-query:hover { background: var(--primary-dark); }

        /* Age Display Box */
        .info-box { background: #e3f2fd; color: #0d47a1; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; text-align: center; border: 1px solid #bbdefb; }

        /* Result Cards */
        .result-area { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        .vaccine-card { background: white; border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 12px; border-left: 5px solid var(--secondary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        .status-due { border-left-color: var(--danger); background: var(--danger-bg); }
        .status-upcoming { border-left-color: var(--success); background: var(--success-bg); }
        .status-adult-rec { border-left-color: var(--primary); background: #f0f7ff; }
        
        .v-title { display: flex; justify-content: space-between; align-items: center; font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; }
        .badge { font-size: 0.8rem; padding: 4px 8px; border-radius: 12px; color: white; background: var(--secondary); }
        .badge.due { background: var(--danger); }
        .badge.upcoming { background: var(--success); }
        .badge.adult { background: var(--primary); }
        
        .v-desc { color: #555; font-size: 0.95rem; line-height: 1.5; }
        .highlight { color: #d63384; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ğŸ¥ å…¬è²»ç–«è‹—è‡¨åºŠæ±ºç­–ç³»çµ±</h2>
        <p>2026å¹´æœ€æ–°ç‰ˆ (å«PCV20/21æ–°åˆ¶)</p>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('child')">ğŸ‘¶ å…’ç«¥å¸¸è¦ç–«è‹—</button>
        <button class="tab-btn" onclick="switchTab('adult')">ğŸ‘´ æˆäºº/é•·è€…ç–«è‹—</button>
    </div>

    <div id="tab-child" class="content-section active">
        <div class="form-group">
            <label>å…’ç«¥å‡ºç”Ÿå¹´æœˆæ—¥ï¼š</label>
            <input type="date" id="childBirthdate" onchange="updateChildAge()">
        </div>
        <div id="childAgeDisplay" class="info-box">è«‹è¼¸å…¥æ—¥æœŸä»¥è¨ˆç®—ç²¾ç¢ºæœˆé½¡</div>
        <button class="btn-query" onclick="queryChildVaccines()">æŸ¥è©¢å…’ç«¥æ¥ç¨®æ™‚ç¨‹</button>
        <div id="childResult" class="result-area"></div>
    </div>

    <div id="tab-adult" class="content-section">
        <div class="form-group">
            <label>ç—…æ‚£å¹´é½¡ (æ­²)ï¼š</label>
            <input type="number" id="adultAge" placeholder="ä¾‹å¦‚ï¼š65">
        </div>

        <div class="form-group">
            <label>ç‰¹æ®Šèº«ä»½ / é¢¨éšªå› å­ï¼š</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" id="pregnant"> å­•å©¦</label>
                <label class="checkbox-item"><input type="checkbox" id="highRisk"> é«˜é¢¨éšªæ…¢æ€§ç—…/å…ç–«ä¸å…¨/æ´—è…</label>
                <label class="checkbox-item"><input type="checkbox" id="medicalStaff"> é†«äº‹/é˜²ç–«äººå“¡</label>
                <label class="checkbox-item"><input type="checkbox" id="nursingHome"> æ©Ÿæ§‹ä½æ°‘</label>
            </div>
        </div>

        <div class="form-group" style="background: #fff8e1; padding: 15px; border-radius: 8px; border: 1px solid #ffeeba;">
            <label style="color: #856404;">ğŸ’‰ è‚ºç‚éˆçƒèŒæ¥ç¨®å² (é‡å°65æ­²+æˆ–é«˜é¢¨éšª)ï¼š</label>
            <select id="pneumoHistory">
                <option value="none">å®Œå…¨æœªæ›¾æ¥ç¨®</option>
                <option value="ppv23">æ›¾æ¥ç¨®é 23åƒ¹ (PPV23)</option>
                <option value="pcv13">æ›¾æ¥ç¨®é 13åƒ¹/15åƒ¹ (PCV13/15)</option>
                <option value="both">å·²å®Œæˆ PCV + PPV æ¥åŠ›</option>
            </select>
            <small style="display:block; margin-top:5px; color:#856404;">* è«‹æŸ¥è©¢ NIIS ç³»çµ±ç¢ºèªéå¾€ç´€éŒ„</small>
        </div>

        <button class="btn-query" onclick="queryAdultVaccines()">æŸ¥è©¢æˆäººå»ºè­°ç–«è‹—</button>
        <div id="adultResult" class="result-area"></div>
    </div>
</div>

<script>
    // ================= æ ¸å¿ƒè³‡æ–™åº« =================
    // å…’ç«¥æ™‚ç¨‹è¡¨ (æœˆé½¡åˆ¶)
    const childSchedule = [
        { name: "Bå‹è‚ç‚ (HepB-2)", month: 1, range: [1, 2], desc: "æ»¿1å€‹æœˆæ¥ç¨®" },
        { name: "äº”åˆä¸€ (1st) + PCV13 (1st)", month: 2, range: [2, 3], desc: "æ»¿2å€‹æœˆæ¥ç¨®" },
        { name: "äº”åˆä¸€ (2nd) + PCV13 (2nd)", month: 4, range: [4, 5], desc: "æ»¿4å€‹æœˆæ¥ç¨®" },
        { name: "å¡ä»‹è‹— (BCG)", month: 5, range: [5, 12], desc: "å»ºè­°5-8å€‹æœˆå®Œæˆ" },
        { name: "äº”åˆä¸€ (3rd) + HepB (3rd)", month: 6, range: [6, 12], desc: "æ»¿6å€‹æœˆæ¥ç¨®" },
        { name: "æµæ„Ÿç–«è‹— (åˆæ¬¡)", month: 6, range: [6, 999], desc: "æ»¿6å€‹æœˆä»¥ä¸Šï¼Œåˆæ¬¡éœ€æ‰“2åŠ‘(éš”4é€±)" },
        { name: "æ°´ç—˜ + MMR (1st) + PCV13 (3rd)", month: 12, range: [12, 18], desc: "æ»¿1æ­²æ¥ç¨®" },
        { name: "Aå‹è‚ç‚ (1st)", month: 12, range: [12, 60], desc: "æ»¿1æ­² (2017å¹´å¾Œå‡ºç”Ÿå…¬è²»)" },
        { name: "æ—¥æœ¬è…¦ç‚ (1st)", month: 15, range: [15, 24], desc: "æ»¿15å€‹æœˆæ¥ç¨®" },
        { name: "äº”åˆä¸€ (4th)", month: 18, range: [18, 30], desc: "æ»¿1æ­²6å€‹æœˆæ¥ç¨®" },
        { name: "Aå‹è‚ç‚ (2nd)", month: 18, range: [18, 120], desc: "éœ€èˆ‡ç¬¬ä¸€åŠ‘é–“éš”6å€‹æœˆ" },
        { name: "æ—¥æœ¬è…¦ç‚ (2nd)", month: 27, range: [27, 48], desc: "æ»¿2æ­²3å€‹æœˆ (èˆ‡ç¬¬ä¸€åŠ‘éš”12å€‹æœˆ)" },
        { name: "å…¥å­¸å‰å››åˆä¸€ + MMR (2nd) + JE (å…¨é‡)", month: 60, range: [60, 84], desc: "æ»¿5æ­²è‡³å…¥å°å­¸å‰" }
    ];

    // ================= ä»‹é¢åˆ‡æ›é‚è¼¯ =================
    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        
        if (tab === 'child') {
            document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
            document.getElementById('tab-child').classList.add('active');
        } else {
            document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
            document.getElementById('tab-adult').classList.add('active');
        }
    }

    // ================= å…’ç«¥é‚è¼¯ =================
    let currentChildMonths = 0;

    function updateChildAge() {
        const input = document.getElementById('childBirthdate').value;
        if (!input) return;
        
        const dob = new Date(input);
        const today = new Date();
        
        let years = today.getFullYear() - dob.getFullYear();
        let months = today.getMonth() - dob.getMonth();
        if (months < 0) { years--; months += 12; }
        
        currentChildMonths = (years * 12) + months;
        const days = Math.floor((today - dob) / (1000 * 60 * 60 * 24));

        let txt = years > 0 ? `${years}æ­²${months}å€‹æœˆ` : (months > 0 ? `${months}å€‹æœˆ` : `${days}å¤©`);
        document.getElementById('childAgeDisplay').innerText = `ç›®å‰å¹´é½¡ï¼š${txt} (ç¸½æœˆé½¡ ${currentChildMonths}m)`;
    }

    function queryChildVaccines() {
        if (!document.getElementById('childBirthdate').value) { alert("è«‹è¼¸å…¥å‡ºç”Ÿæ—¥æœŸ"); return; }
        
        const resDiv = document.getElementById('childResult');
        let html = "";
        
        // ç¯©é¸é‚è¼¯
        const due = childSchedule.filter(v => currentChildMonths >= v.month && (currentChildMonths - v.month < 24 || v.month >= 60));
        const upcoming = childSchedule.filter(v => v.month > currentChildMonths && v.month <= currentChildMonths + 6);

        if (due.length > 0) {
            html += `<h3 style="color:#dc3545">ğŸš¨ å»ºè­°æœ¬æ¬¡è©•ä¼°é …ç›®</h3>`;
            due.forEach(v => {
                html += renderCard(v.name, v.desc, "æ‡‰æ¥ç¨®", "due", "status-due");
            });
        } else {
            html += `<div style="text-align:center; padding:20px; color:#28a745;">âœ… ç›®å‰ç„¡ç©æ¬ ä¹‹å¸¸è¦ç–«è‹—</div>`;
        }

        if (upcoming.length > 0) {
            html += `<h3 style="margin-top:20px; color:#28a745">ğŸ”œ æœªä¾†åŠå¹´é å‘Š</h3>`;
            upcoming.forEach(v => {
                html += renderCard(v.name, v.desc, `é è¨ˆ${v.month - currentChildMonths}å€‹æœˆå¾Œ`, "upcoming", "status-upcoming");
            });
        }
        resDiv.innerHTML = html;
    }

    // ================= æˆäººé‚è¼¯ =================
    function queryAdultVaccines() {
        const age = parseInt(document.getElementById('adultAge').value);
        if (isNaN(age)) { alert("è«‹è¼¸å…¥å¹´é½¡"); return; }

        const isPreg = document.getElementById('pregnant').checked;
        const isHighRisk = document.getElementById('highRisk').checked;
        const isMed = document.getElementById('medicalStaff').checked;
        const history = document.getElementById('pneumoHistory').value;
        
        let list = [];

        // 1. æµæ„Ÿ
        list.push({ name: "æµæ„Ÿç–«è‹—", desc: "å…¨æ°‘é–‹æ‰“ä¸­ (è‡³ç–«è‹—ç”¨ç½„)", tag: "å­£ç¯€æ€§" });

        // 2. è‚ºç‚éˆçƒèŒ (2026é‡é»)
        // è³‡æ ¼ï¼š65æ­²ä»¥ä¸Š OR (19-64ä¸”é«˜é¢¨éšª)
        if (age >= 65 || (age >= 19 && isHighRisk)) {
            let advice = "";
            let eligible = false;

            if (history === 'none') {
                advice = "å»ºè­°æ¥ç¨® 1 åŠ‘ <span class='highlight'>PCV20 æˆ– PCV21</span>ã€‚";
                eligible = true;
            } else if (history === 'ppv23') {
                advice = "æ›¾æ‰“éPPV23ï¼šéœ€é–“éš”è‡³å°‘1å¹´ï¼Œå»ºè­°æ¥ç¨® 1 åŠ‘ <span class='highlight'>PCV20/21</span>ã€‚";
                eligible = true;
            } else if (history === 'pcv13') {
                advice = "æ›¾æ‰“éPCV13/15ï¼šéœ€é–“éš”è‡³å°‘1å¹´ï¼Œå»ºè­°æ¥ç¨® 1 åŠ‘ <span class='highlight'>PCV20/21</span>ã€‚";
                eligible = true;
            } else {
                advice = "å·²å®Œæˆå®Œæ•´æ¥ç¨®ï¼Œç›®å‰æ”¿ç­–ä¸éœ€è£œæ‰“ã€‚";
            }

            if (eligible) {
                list.push({ name: "è‚ºç‚éˆçƒèŒ (PCV20/21)", desc: `<strong>2026æ–°åˆ¶ï¼š</strong>${advice}`, tag: "å»ºè­°æ¥ç¨®" });
            }
        }

        // 3. å­•å©¦ Tdap
        if (isPreg) list.push({ name: "Tdap (ç ´å‚·é¢¨/æ¸›é‡ç™½å–‰/ç™¾æ—¥å’³)", desc: "æ‡·å­•28-36é€±æ¥ç¨®1åŠ‘ï¼Œä¿è­·èƒå…’ã€‚", tag: "å­•å©¦å°ˆç”¨" });

        // 4. é†«äº‹äººå“¡ MMR/HepB
        if (isMed) list.push({ name: "MMR / Bè‚ / æµæ„Ÿ", desc: "è«‹ç¢ºèªæŠ—é«”é™½æ€§ç‹€æ³ï¼Œè‹¥ç„¡æŠ—é«”å»ºè­°è£œç¨®ã€‚", tag: "é†«äº‹äººå“¡" });

        // æ¸²æŸ“
        const resDiv = document.getElementById('adultResult');
        let html = "<h3>ğŸ” æŸ¥è©¢çµæœ</h3>";
        list.forEach(v => {
            html += renderCard(v.name, v.desc, v.tag, "adult", "status-adult-rec");
        });
        resDiv.innerHTML = html;
    }

    // ================= é€šç”¨æ¸²æŸ“å‡½æ•¸ =================
    function renderCard(title, desc, badgeText, badgeClass, cardClass) {
        return `
            <div class="vaccine-card ${cardClass}">
                <div class="v-title">
                    ${title}
                    <span class="badge ${badgeClass}">${badgeText}</span>
                </div>
                <div class="v-desc">${desc}</div>
            </div>
        `;
    }
</script>

</body>
</html>