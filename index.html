<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é†«é™¢è—¥å¸«å°ˆç”¨ - ç–«è‹—æ±ºç­–ç³»çµ± (20260118)</title>

    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-title" content="ç–«è‹—æŸ¥è©¢">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <style>
        :root {
            --primary: #007bff; 
            --secondary: #6c757d;
            --success: #28a745; --success-bg: #e6fffa;
            --danger: #dc3545; --danger-bg: #fff5f5;
            --purple: #6f42c1; --purple-bg: #f3f0ff; /* è‡ªè²»è‰² */
            --pink: #d63384; --pink-bg: #fff0f6; /* å©¦å¹¼/HPVè‰² */
            --light: #f8f9fa;
        }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; }
        
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        .header h2 { margin: 0; font-size: 1.5rem; }
        
        .tabs { display: flex; background: #e9ecef; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: transparent; cursor: pointer; font-size: 1.1rem; font-weight: bold; color: var(--secondary); border-bottom: 4px solid transparent; }
        .tab-btn.active { background: white; color: var(--primary); border-bottom-color: var(--primary); }
        .content-section { padding: 25px; display: none; }
        .content-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #495057; }
        input[type="date"], input[type="number"], select { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 10px; }
        .checkbox-item { background: var(--light); padding: 10px; border-radius: 8px; display: flex; align-items: center; cursor: pointer; border: 1px solid #dee2e6; }
        .checkbox-item:hover { border-color: var(--primary); }
        .checkbox-item input { width: auto; margin-right: 10px; transform: scale(1.2); }

        .btn-query { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-query:hover { background: #0056b3; }

        .info-box { background: #e3f2fd; color: #0d47a1; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; text-align: center; border: 1px solid #bbdefb; }

        .result-area { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        .vaccine-card { background: white; border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 12px; border-left: 6px solid var(--secondary); }
        
        /* å¡ç‰‡ç‹€æ…‹è‰² */
        .status-due { border-left-color: var(--danger); background: var(--danger-bg); }
        .status-self { border-left-color: var(--purple); background: var(--purple-bg); }
        .status-hpv { border-left-color: var(--pink); background: var(--pink-bg); }
        .status-upcoming { border-left-color: var(--success); background: var(--success-bg); }
        .status-adult-rec { border-left-color: var(--primary); background: #f0f7ff; }

        .v-title { display: flex; justify-content: space-between; align-items: center; font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; }
        .badge { font-size: 0.8rem; padding: 4px 8px; border-radius: 12px; color: white; background: var(--secondary); margin-left: 5px;}
        .badge.public { background: var(--danger); }
        .badge.self { background: var(--purple); }
        .badge.hpv-public { background: var(--pink); }
        .badge.upcoming { background: var(--success); }
        .badge.adult { background: var(--primary); }
        
        .v-desc { color: #555; font-size: 0.95rem; line-height: 1.5; }
        .highlight { color: #d63384; font-weight: bold; }
        
        .toggle-container { display: flex; align-items: center; justify-content: flex-end; margin-bottom: 10px; }
        .toggle-label { font-size: 0.9rem; margin-right: 10px; font-weight: bold; color: var(--purple); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ğŸ¥ ç–«è‹—è‡¨åºŠæ±ºç­–ç³»çµ± V4</h2>
        <p>æ•´åˆ çš®è›‡(Shingrix) / HPV / è‚ºç‚éˆçƒèŒ / å…’ç«¥å¸¸è¦</p>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('child')">ğŸ‘¶ å…’ç«¥/é’å°‘å¹´</button>
        <button class="tab-btn" onclick="switchTab('adult')">ğŸ‘´ æˆäºº/é•·è€…</button>
    </div>

    <div id="tab-child" class="content-section active">
        <div class="form-group">
            <label>å…’ç«¥å‡ºç”Ÿå¹´æœˆæ—¥ï¼š</label>
            <input type="date" id="childBirthdate" onchange="updateChildAge()">
        </div>
        
        <div class="form-group">
            <label>æ€§åˆ¥ (å½±éŸ¿HPVå…¬è²»åˆ¤æ–·)ï¼š</label>
            <select id="childGender" onchange="if(document.getElementById('childBirthdate').value) queryChildVaccines()">
                <option value="male">ç”·</option>
                <option value="female">å¥³</option>
            </select>
        </div>

        <div class="toggle-container">
            <span class="toggle-label">é¡¯ç¤ºè‡ªè²»å»ºè­°</span>
            <input type="checkbox" id="showSelfPaid" checked onchange="if(document.getElementById('childBirthdate').value) queryChildVaccines()">
        </div>

        <div id="childAgeDisplay" class="info-box">è«‹è¼¸å…¥è³‡æ–™</div>
        <button class="btn-query" onclick="queryChildVaccines()">æŸ¥è©¢æ™‚ç¨‹</button>
        <div id="childResult" class="result-area"></div>
    </div>

    <div id="tab-adult" class="content-section">
        <div class="form-group">
            <label>å¹´é½¡ (æ­²)ï¼š</label>
            <input type="number" id="adultAge" placeholder="ä¾‹å¦‚ï¼š55">
        </div>

        <div class="form-group">
            <label>ç‰¹æ®Šèº«ä»½ / é¢¨éšªå› å­ï¼š</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" id="pregnant"> å­•å©¦</label>
                <label class="checkbox-item"><input type="checkbox" id="highRisk"> é«˜é¢¨éšª/å…ç–«ä½ä¸‹(å«æ´—è…/ç™Œç—‡/ç§»æ¤)</label>
                <label class="checkbox-item"><input type="checkbox" id="medicalStaff"> é†«äº‹äººå“¡</label>
            </div>
        </div>

        <div class="form-group" style="background: #fff8e1; padding: 15px; border-radius: 8px; border: 1px solid #ffeeba;">
            <label style="color: #856404;">ğŸ’‰ è‚ºç‚éˆçƒèŒæ¥ç¨®å² (é‡å°65æ­²+æˆ–é«˜é¢¨éšª)ï¼š</label>
            <select id="pneumoHistory">
                <option value="none">å®Œå…¨æœªæ›¾æ¥ç¨®</option>
                <option value="ppv23">æ›¾æ¥ç¨®é 23åƒ¹ (PPV23)</option>
                <option value="pcv13">æ›¾æ¥ç¨®é 13åƒ¹/15åƒ¹ (PCV13/15)</option>
                <option value="both">å·²å®Œæˆ PCV + PPV æ¥åŠ›</option>
            </select>
        </div>

        <button class="btn-query" onclick="queryAdultVaccines()">æŸ¥è©¢æˆäººå»ºè­°</button>
        <div id="adultResult" class="result-area"></div>
    </div>
</div>

<script>
    // ================= å…’ç«¥/é’å°‘å¹´è³‡æ–™åº« =================
    const childSchedule = [
        { name: "Bå‹è‚ç‚ (HepB-2)", month: 1, range: [1, 2], type: 'public', desc: "å…¬è²»ã€‚æ»¿1å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "äº”åˆä¸€ + PCV13 (ç¬¬1åŠ‘)", month: 2, range: [2, 3], type: 'public', desc: "å…¬è²»ã€‚æ»¿2å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "äº”åˆä¸€ + PCV13 (ç¬¬2åŠ‘)", month: 4, range: [4, 5], type: 'public', desc: "å…¬è²»ã€‚æ»¿4å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "å¡ä»‹è‹— (BCG)", month: 5, range: [5, 12], type: 'public', desc: "å…¬è²»ã€‚å»ºè­°5-8å€‹æœˆå®Œæˆã€‚" },
        { name: "äº”åˆä¸€ + Bè‚ (ç¬¬3åŠ‘)", month: 6, range: [6, 12], type: 'public', desc: "å…¬è²»ã€‚æ»¿6å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "æµæ„Ÿç–«è‹— (åˆæ¬¡)", month: 6, range: [6, 999], type: 'public', desc: "å…¬è²»ã€‚æ»¿6å€‹æœˆä»¥ä¸Šï¼Œåˆæ¬¡éœ€æ‰“2åŠ‘ã€‚" },
        { name: "æ°´ç—˜ + MMR + PCV13 (æ»¿æ­²)", month: 12, range: [12, 18], type: 'public', desc: "å…¬è²»ã€‚æ»¿1æ­²æ¥ç¨®ã€‚" },
        { name: "Aå‹è‚ç‚ (ç¬¬1åŠ‘)", month: 12, range: [12, 60], type: 'public', desc: "å…¬è²»ã€‚æ»¿1æ­²æ¥ç¨®ã€‚" },
        { name: "æ—¥æœ¬è…¦ç‚ (ç¬¬1åŠ‘)", month: 15, range: [15, 24], type: 'public', desc: "å…¬è²»ã€‚æ»¿15å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "äº”åˆä¸€ (ç¬¬4åŠ‘)", month: 18, range: [18, 30], type: 'public', desc: "å…¬è²»ã€‚æ»¿1æ­²åŠæ¥ç¨®ã€‚" },
        { name: "Aå‹è‚ç‚ (ç¬¬2åŠ‘)", month: 18, range: [18, 120], type: 'public', desc: "å…¬è²»ã€‚éœ€èˆ‡ç¬¬ä¸€åŠ‘é–“éš”6å€‹æœˆã€‚" },
        { name: "æ—¥æœ¬è…¦ç‚ (ç¬¬2åŠ‘)", month: 27, range: [27, 48], type: 'public', desc: "å…¬è²»ã€‚æ»¿2æ­²3å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "å…¥å­¸å‰å››åˆä¸€+MMR+JE", month: 60, range: [60, 84], type: 'public', desc: "å…¬è²»ã€‚æ»¿5æ­²è‡³å…¥å°å­¸å‰ã€‚" },
        // è‡ªè²»
        { name: "è¼ªç‹€ç—…æ¯’", month: 2, range: [1.5, 8], type: 'self', desc: "ğŸ’¡å»ºè­°è‡ªè²»ã€‚å‡ºç”Ÿ15é€±å…§é–‹å§‹ï¼Œ8å€‹æœˆå…§å®Œæˆã€‚" },
        { name: "è…¸ç—…æ¯’ 71 å‹", month: 2, range: [2, 72], type: 'self', desc: "ğŸ’¡å»ºè­°è‡ªè²»ã€‚æ»¿2å€‹æœˆè‡³6æ­²é©ç”¨ã€‚" },
        { name: "Bå‹è…¦è†œç‚é›™çƒèŒ", month: 2, range: [2, 600], type: 'self', desc: "å»ºè­°è‡ªè²»ã€‚æ»¿2å€‹æœˆä»¥ä¸Šå³å¯ã€‚" },
        // HPV
        { name: "HPV 9åƒ¹ç–«è‹— (å…¬è²»)", month: 132, range: [132, 180], type: 'hpv-public', gender: 'female', desc: "ğŸ’– å…¬è²»å°ˆæ¡ˆï¼šåœ‹ä¸­å…¥å­¸å¥³ç”Ÿ(ç´„11-13æ­²)ã€‚" },
        { name: "HPV 9åƒ¹ç–«è‹— (è‡ªè²»)", month: 108, range: [108, 540], type: 'self', desc: "ğŸ’¡å»ºè­°è‡ªè²»ã€‚9-45æ­²ç”·å¥³çš†é©ç”¨ã€‚" }
    ];

    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        if (tab === 'child') {
            document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
            document.getElementById('tab-child').classList.add('active');
        } else {
            document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
            document.getElementById('tab-adult').classList.add('active');
        }
    }

    let currentChildMonths = 0;
    function updateChildAge() {
        const input = document.getElementById('childBirthdate').value;
        if (!input) return;
        const dob = new Date(input);
        const today = new Date();
        let years = today.getFullYear() - dob.getFullYear();
        let months = today.getMonth() - dob.getMonth();
        if (months < 0) { years--; months += 12; }
        currentChildMonths = (years * 12) + months;
        document.getElementById('childAgeDisplay').innerHTML = `ç›®å‰å¹´é½¡ï¼š${years}æ­²${months}å€‹æœˆ (ç¸½æœˆé½¡: ${currentChildMonths}m)`;
    }

    function queryChildVaccines() {
        if (!document.getElementById('childBirthdate').value) { alert("è«‹è¼¸å…¥å‡ºç”Ÿæ—¥æœŸ"); return; }
        const showSelf = document.getElementById('showSelfPaid').checked;
        const gender = document.getElementById('childGender').value;
        const resDiv = document.getElementById('childResult');
        let html = "";
        
        let due = [];
        let upcoming = [];

        childSchedule.forEach(v => {
            if (v.type === 'self' && !showSelf) return; 
            if (v.name.includes("è¼ªç‹€") && currentChildMonths > 8) return;
            if (v.type === 'hpv-public' && gender !== 'female') return; 
            if (v.name.includes("HPV") && v.type === 'self' && gender === 'female' && currentChildMonths >= 132 && currentChildMonths <= 180) return;

            if (currentChildMonths >= v.month) {
                if ((currentChildMonths - v.month < 24) || v.month >= 60 || (v.type==='self' && currentChildMonths < v.range[1]) || v.type === 'hpv-public') {
                    if (currentChildMonths <= v.range[1]) due.push(v);
                }
            } else if (v.month > currentChildMonths && v.month <= currentChildMonths + 12) {
                upcoming.push(v);
            }
        });

        due.sort((a,b) => a.month - b.month);

        if (due.length > 0) {
            html += `<h3>ğŸš¨ æœ¬æ¬¡å°±é†«å»ºè­°</h3>`;
            due.forEach(v => {
                let badgeClass = 'public'; let cardClass = 'status-due'; let badgeText = 'å…¬è²»æ‡‰æ‰“';
                if (v.type === 'self') { badgeClass = 'self'; cardClass = 'status-self'; badgeText = 'è‡ªè²»å»ºè­°'; } 
                else if (v.type === 'hpv-public') { badgeClass = 'hpv-public'; cardClass = 'status-hpv'; badgeText = 'å…¬è²»(å°ˆæ¡ˆ)'; }
                
                html += renderCard(v.name, v.desc, badgeText, badgeClass, cardClass);
            });
        } else {
            html += `<div style="text-align:center; padding:20px; color:#28a745;">âœ… ç›®å‰ç„¡å»ºè­°é …ç›®</div>`;
        }
        resDiv.innerHTML = html;
    }

    // ================= æˆäººé‚è¼¯ (æ–°å¢ Shingrix) =================
    function queryAdultVaccines() {
        const age = parseInt(document.getElementById('adultAge').value);
        if (isNaN(age)) { alert("è«‹è¼¸å…¥å¹´é½¡"); return; }
        const isPreg = document.getElementById('pregnant').checked;
        const isHighRisk = document.getElementById('highRisk').checked;
        const isMed = document.getElementById('medicalStaff').checked;
        const history = document.getElementById('pneumoHistory').value;
        let list = [];

        // 1. æµæ„Ÿ
        list.push({ name: "æµæ„Ÿç–«è‹—", desc: "å…¨æ°‘é–‹æ‰“ä¸­", tag: "å­£ç¯€æ€§" });

        // 2. å¸¶ç‹€ç–±ç–¹ (Shingrix) - é‡é»æ–°å¢
        if (age >= 50 || (age >= 18 && isHighRisk)) {
            list.push({ 
                name: "å¸¶ç‹€ç–±ç–¹ç–«è‹— (Shingrix)", 
                desc: "ğŸ’¡<strong>å¼·çƒˆå»ºè­°(è‡ªè²»)ã€‚</strong>éæ´»æ€§åŸºå› é‡çµ„ç–«è‹—ï¼Œä¿è­·åŠ›>90%ã€‚éœ€æ–½æ‰“2åŠ‘ (é–“éš”2-6å€‹æœˆ)ã€‚", 
                tag: "è‡ªè²»" 
            });
        }

        // 3. HPV
        if (age >= 18 && age <= 45) {
            list.push({ name: "HPV 9åƒ¹ç–«è‹—", desc: "å»ºè­°è‡ªè²»ã€‚ç”·å¥³çš†é©ç”¨ã€‚", tag: "è‡ªè²»" });
        }

        // 4. è‚ºç‚éˆçƒèŒ (å…¬è²»)
        if (age >= 65 || (age >= 19 && isHighRisk)) {
            let advice = "";
            let eligible = false;
            if (history === 'none') { advice = "å»ºè­°æ¥ç¨® 1 åŠ‘ <span class='highlight'>PCV20 æˆ– PCV21</span>ã€‚"; eligible = true; }
            else if (history === 'ppv23') { advice = "æ›¾æ‰“éPPV23ï¼šéœ€é–“éš”è‡³å°‘1å¹´ï¼Œæ¥ç¨® PCV20/21ã€‚"; eligible = true; }
            else if (history === 'pcv13') { advice = "æ›¾æ‰“éPCV13/15ï¼šéœ€é–“éš”è‡³å°‘1å¹´ï¼Œæ¥ç¨® PCV20/21ã€‚"; eligible = true; }
            if (eligible) list.push({ name: "è‚ºç‚éˆçƒèŒ (PCV20/21)", desc: `å…¬è²»è³‡æ ¼(æ–°åˆ¶)ï¼š${advice}`, tag: "å…¬è²»å»ºè­°" });
        }

        // 5. Tdap / MMR
        if (isPreg) list.push({ name: "Tdap (ç ´å‚·é¢¨/ç™¾æ—¥å’³)", desc: "æ‡·å­•28-36é€±æ¥ç¨®1åŠ‘ã€‚", tag: "å­•å©¦å°ˆç”¨" });
        if (isMed) list.push({ name: "MMR / Bè‚ / æµæ„Ÿ", desc: "ç¢ºèªæŠ—é«”ç‹€æ³ï¼Œä¸è¶³å»ºè­°è£œç¨®ã€‚", tag: "é†«äº‹äººå“¡" });

        const resDiv = document.getElementById('adultResult');
        let html = "<h3>ğŸ” æŸ¥è©¢çµæœ</h3>";
        list.forEach(v => {
            // åˆ¤æ–·æ¨£å¼: è‡ªè²»ç´«è‰², å…¬è²»è—è‰²/ç´…è‰²
            let cardClass = v.tag === 'è‡ªè²»' ? 'status-self' : 'status-adult-rec';
            let badgeClass = v.tag === 'è‡ªè²»' ? 'self' : 'adult';
            
            html += renderCard(v.name, v.desc, v.tag, badgeClass, cardClass);
        });
        resDiv.innerHTML = html;
    }

    function renderCard(title, desc, badgeText, badgeClass, cardClass) {
        return `
            <div class="vaccine-card ${cardClass}">
                <div class="v-title">
                    ${title}
                    <span class="badge ${badgeClass}">${badgeText}</span>
                </div>
                <div class="v-desc">${desc}</div>
            </div>
        `;
    }
</script>

</body>
</html>

