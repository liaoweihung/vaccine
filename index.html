<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é†«é™¢è—¥å¸«å°ˆç”¨ - ç–«è‹—æ±ºç­–ç³»çµ± (å«è‡ªè²»)</title>
    <style>
        :root {
            --primary: #007bff; 
            --secondary: #6c757d;
            --success: #28a745; --success-bg: #e6fffa;
            --danger: #dc3545; --danger-bg: #fff5f5;
            --purple: #6f42c1; --purple-bg: #f3f0ff; /* è‡ªè²»å°ˆç”¨è‰² */
            --light: #f8f9fa;
        }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); overflow: hidden; }
        
        /* Header & Tabs */
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; }
        .header h2 { margin: 0; font-size: 1.5rem; }
        .header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; }
        
        .tabs { display: flex; background: #e9ecef; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: transparent; cursor: pointer; font-size: 1.1rem; font-weight: bold; color: var(--secondary); border-bottom: 4px solid transparent; transition: 0.2s; }
        .tab-btn:hover { background: #dee2e6; }
        .tab-btn.active { background: white; color: var(--primary); border-bottom-color: var(--primary); }

        /* Content Sections */
        .content-section { padding: 25px; display: none; }
        .content-section.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Form Elements */
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #495057; }
        input[type="date"], input[type="number"], select { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
        .checkbox-item { background: var(--light); padding: 10px; border-radius: 8px; display: flex; align-items: center; cursor: pointer; border: 1px solid #dee2e6; }
        .checkbox-item input { width: auto; margin-right: 10px; transform: scale(1.2); }

        .btn-query { width: 100%; padding: 14px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-query:hover { background: #0056b3; }

        .info-box { background: #e3f2fd; color: #0d47a1; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; text-align: center; border: 1px solid #bbdefb; }

        /* Result Cards */
        .result-area { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        .vaccine-card { background: white; border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 12px; border-left: 6px solid var(--secondary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        /* ç‹€æ…‹é¡è‰²å®šç¾© */
        .status-due { border-left-color: var(--danger); background: var(--danger-bg); } /* å…¬è²»æ‡‰æ‰“ */
        .status-self { border-left-color: var(--purple); background: var(--purple-bg); } /* è‡ªè²»æ¨è–¦ */
        .status-upcoming { border-left-color: var(--success); background: var(--success-bg); } /* æœªä¾†é å‘Š */
        .status-adult-rec { border-left-color: var(--primary); background: #f0f7ff; }

        .v-title { display: flex; justify-content: space-between; align-items: center; font-size: 1.1rem; font-weight: bold; margin-bottom: 5px; }
        
        .badge { font-size: 0.8rem; padding: 4px 8px; border-radius: 12px; color: white; background: var(--secondary); margin-left: 5px; }
        .badge.public { background: var(--danger); }
        .badge.self { background: var(--purple); }
        .badge.upcoming { background: var(--success); }
        .badge.adult { background: var(--primary); }
        
        .v-desc { color: #555; font-size: 0.95rem; line-height: 1.5; }
        .highlight { color: #d63384; font-weight: bold; }
        
        /* è‡ªè²»é–‹é—œ */
        .toggle-container { display: flex; align-items: center; justify-content: flex-end; margin-bottom: 10px; }
        .toggle-label { font-size: 0.9rem; margin-right: 10px; font-weight: bold; color: var(--purple); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ğŸ¥ ç–«è‹—è‡¨åºŠæ±ºç­–ç³»çµ± (å…¬è²»+è‡ªè²»)</h2>
        <p>2026å¹´æœ€æ–°ç‰ˆï½œè—¥å¸«å°ˆç”¨</p>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('child')">ğŸ‘¶ å…’ç«¥ç–«è‹— (å…¬/è‡ªè²»)</button>
        <button class="tab-btn" onclick="switchTab('adult')">ğŸ‘´ æˆäºº/é•·è€…ç–«è‹—</button>
    </div>

    <div id="tab-child" class="content-section active">
        <div class="form-group">
            <label>å…’ç«¥å‡ºç”Ÿå¹´æœˆæ—¥ï¼š</label>
            <input type="date" id="childBirthdate" onchange="updateChildAge()">
        </div>
        
        <div class="toggle-container">
            <span class="toggle-label">é¡¯ç¤ºè‡ªè²»é …ç›®</span>
            <input type="checkbox" id="showSelfPaid" checked onchange="if(document.getElementById('childBirthdate').value) queryChildVaccines()">
        </div>

        <div id="childAgeDisplay" class="info-box">è«‹è¼¸å…¥æ—¥æœŸä»¥è¨ˆç®—ç²¾ç¢ºæœˆé½¡</div>
        <button class="btn-query" onclick="queryChildVaccines()">æŸ¥è©¢å…’ç«¥æ¥ç¨®æ™‚ç¨‹</button>
        <div id="childResult" class="result-area"></div>
    </div>

    <div id="tab-adult" class="content-section">
        <div class="form-group">
            <label>ç—…æ‚£å¹´é½¡ (æ­²)ï¼š</label>
            <input type="number" id="adultAge" placeholder="ä¾‹å¦‚ï¼š65">
        </div>

        <div class="form-group">
            <label>ç‰¹æ®Šèº«ä»½ / é¢¨éšªå› å­ï¼š</label>
            <div class="checkbox-group">
                <label class="checkbox-item"><input type="checkbox" id="pregnant"> å­•å©¦</label>
                <label class="checkbox-item"><input type="checkbox" id="highRisk"> é«˜é¢¨éšªæ…¢æ€§ç—…/æ´—è…</label>
                <label class="checkbox-item"><input type="checkbox" id="medicalStaff"> é†«äº‹äººå“¡</label>
            </div>
        </div>

        <div class="form-group" style="background: #fff8e1; padding: 15px; border-radius: 8px; border: 1px solid #ffeeba;">
            <label style="color: #856404;">ğŸ’‰ è‚ºç‚éˆçƒèŒæ¥ç¨®å² (é‡å°65æ­²+æˆ–é«˜é¢¨éšª)ï¼š</label>
            <select id="pneumoHistory">
                <option value="none">å®Œå…¨æœªæ›¾æ¥ç¨®</option>
                <option value="ppv23">æ›¾æ¥ç¨®é 23åƒ¹ (PPV23)</option>
                <option value="pcv13">æ›¾æ¥ç¨®é 13åƒ¹/15åƒ¹ (PCV13/15)</option>
                <option value="both">å·²å®Œæˆ PCV + PPV æ¥åŠ›</option>
            </select>
        </div>

        <button class="btn-query" onclick="queryAdultVaccines()">æŸ¥è©¢æˆäººå»ºè­°ç–«è‹—</button>
        <div id="adultResult" class="result-area"></div>
    </div>
</div>

<script>
    // ================= å…’ç«¥è³‡æ–™åº« (å…¬è²» + è‡ªè²») =================
    // type: 'public' or 'self'
    // month: å»ºè­°é–‹å§‹æœˆé½¡
    // range: [min, max] å»ºè­°æ–½æ‰“å€é–“(æœˆé½¡)
    
    const childSchedule = [
        // --- å…¬è²»é …ç›® ---
        { name: "Bå‹è‚ç‚ (HepB-2)", month: 1, range: [1, 2], type: 'public', desc: "å…¬è²»ã€‚æ»¿1å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "äº”åˆä¸€ + PCV13 (ç¬¬1åŠ‘)", month: 2, range: [2, 3], type: 'public', desc: "å…¬è²»ã€‚æ»¿2å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "äº”åˆä¸€ + PCV13 (ç¬¬2åŠ‘)", month: 4, range: [4, 5], type: 'public', desc: "å…¬è²»ã€‚æ»¿4å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "å¡ä»‹è‹— (BCG)", month: 5, range: [5, 12], type: 'public', desc: "å…¬è²»ã€‚å»ºè­°5-8å€‹æœˆå®Œæˆã€‚" },
        { name: "äº”åˆä¸€ + Bè‚ (ç¬¬3åŠ‘)", month: 6, range: [6, 12], type: 'public', desc: "å…¬è²»ã€‚æ»¿6å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "æµæ„Ÿç–«è‹— (åˆæ¬¡)", month: 6, range: [6, 999], type: 'public', desc: "å…¬è²»ã€‚æ»¿6å€‹æœˆä»¥ä¸Šï¼Œåˆæ¬¡éœ€æ‰“2åŠ‘(éš”4é€±)ã€‚" },
        { name: "æ°´ç—˜ + MMR + PCV13 (æ»¿æ­²)", month: 12, range: [12, 18], type: 'public', desc: "å…¬è²»ã€‚æ»¿1æ­²æ¥ç¨®ã€‚" },
        { name: "Aå‹è‚ç‚ (ç¬¬1åŠ‘)", month: 12, range: [12, 60], type: 'public', desc: "å…¬è²»ã€‚æ»¿1æ­²æ¥ç¨® (2017å¾Œå‡ºç”Ÿ)ã€‚" },
        { name: "æ—¥æœ¬è…¦ç‚ (ç¬¬1åŠ‘)", month: 15, range: [15, 24], type: 'public', desc: "å…¬è²»ã€‚æ»¿15å€‹æœˆæ¥ç¨®ã€‚" },
        { name: "äº”åˆä¸€ (ç¬¬4åŠ‘)", month: 18, range: [18, 30], type: 'public', desc: "å…¬è²»ã€‚æ»¿1æ­²åŠæ¥ç¨®ã€‚" },
        { name: "Aå‹è‚ç‚ (ç¬¬2åŠ‘)", month: 18, range: [18, 120], type: 'public', desc: "å…¬è²»ã€‚éœ€èˆ‡ç¬¬ä¸€åŠ‘é–“éš”6å€‹æœˆã€‚" },
        { name: "æ—¥æœ¬è…¦ç‚ (ç¬¬2åŠ‘)", month: 27, range: [27, 48], type: 'public', desc: "å…¬è²»ã€‚èˆ‡ç¬¬ä¸€åŠ‘é–“éš”12å€‹æœˆã€‚" },
        { name: "å…¥å­¸å‰å››åˆä¸€+MMR+JE", month: 60, range: [60, 84], type: 'public', desc: "å…¬è²»ã€‚æ»¿5æ­²è‡³å…¥å°å­¸å‰ã€‚" },

        // --- è‡ªè²»é …ç›® (æ–°å¢) ---
        { 
            name: "è¼ªç‹€ç—…æ¯’ (Rotavirus)", 
            month: 2, range: [1.5, 8], 
            type: 'self', 
            desc: "ğŸ’¡å¼·çƒˆå»ºè­°ã€‚å£æœ2åŠ‘æˆ–3åŠ‘ã€‚<br><strong style='color:#d63384'>æ³¨æ„ï¼šç¬¬1åŠ‘éœ€æ–¼å‡ºç”Ÿ15é€±å…§æœç”¨ï¼Œå…¨éƒ¨åŠ‘æ¬¡éœ€æ–¼8å€‹æœˆå…§å®Œæˆã€‚</strong>" 
        },
        { 
            name: "è…¸ç—…æ¯’ 71 å‹ (EV71)", 
            month: 2, range: [2, 72], 
            type: 'self', 
            desc: "ğŸ’¡å»ºè­°æ¥ç¨®ã€‚æ»¿2å€‹æœˆè‡³6æ­²é©ç”¨ã€‚ä¾å» ç‰Œéœ€æ‰“2åŠ‘æˆ–3åŠ‘(å«è¿½åŠ )ã€‚é é˜²é‡ç—‡æ•ˆæœä½³ã€‚" 
        },
        { 
            name: "Bå‹è…¦è†œç‚é›™çƒèŒ (4CMenB)", 
            month: 2, range: [2, 600], 
            type: 'self', 
            desc: "å»ºè­°æ¥ç¨®ã€‚æ»¿2å€‹æœˆä»¥ä¸Šå³å¯æ¥ç¨®ã€‚åŠ‘æ¬¡ä¾é–‹å§‹æ¥ç¨®å¹´é½¡è€Œç•°(2-3åŠ‘)ã€‚" 
        }
    ];

    // ================= ä»‹é¢åˆ‡æ›é‚è¼¯ =================
    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        
        if (tab === 'child') {
            document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
            document.getElementById('tab-child').classList.add('active');
        } else {
            document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
            document.getElementById('tab-adult').classList.add('active');
        }
    }

    // ================= å…’ç«¥é‚è¼¯ =================
    let currentChildMonths = 0;

    function updateChildAge() {
        const input = document.getElementById('childBirthdate').value;
        if (!input) return;
        
        const dob = new Date(input);
        const today = new Date();
        
        let years = today.getFullYear() - dob.getFullYear();
        let months = today.getMonth() - dob.getMonth();
        if (months < 0) { years--; months += 12; }
        
        currentChildMonths = (years * 12) + months;
        // è¨ˆç®—é€±æ•¸ (é‡å°è¼ªç‹€ç—…æ¯’)
        const diffTime = Math.abs(today - dob);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
        const weeks = Math.floor(diffDays / 7);

        let txt = years > 0 ? `${years}æ­²${months}å€‹æœˆ` : (months > 0 ? `${months}å€‹æœˆ` : `${diffDays}å¤©`);
        document.getElementById('childAgeDisplay').innerHTML = `ç›®å‰å¹´é½¡ï¼š${txt} <br><span style="font-size:0.9em; color:#666">(ç¸½æœˆé½¡: ${currentChildMonths}m / é€±æ•¸: ${weeks}w)</span>`;
    }

    function queryChildVaccines() {
        if (!document.getElementById('childBirthdate').value) { alert("è«‹è¼¸å…¥å‡ºç”Ÿæ—¥æœŸ"); return; }
        
        const showSelf = document.getElementById('showSelfPaid').checked;
        const resDiv = document.getElementById('childResult');
        let html = "";
        
        // ç¯©é¸
        let due = [];
        let upcoming = [];

        childSchedule.forEach(v => {
            if (v.type === 'self' && !showSelf) return; // ä¸é¡¯ç¤ºè‡ªè²»

            // é‚è¼¯: 
            // Due: é”åˆ°å»ºè­°æœˆé½¡ï¼Œä¸”æœªè¶…éæœ€å¤§ç¯„åœå¤ªä¹… (æˆ–æ˜¯å¸¸è¦å¿…å‚™)
            // Upcoming: æœªä¾†6å€‹æœˆå…§
            
            // ç‰¹åˆ¥è™•ç†è¼ªç‹€ç—…æ¯’çš„éæœŸé‚è¼¯ (è¶…é8å€‹æœˆå°±ä¸é¡¯ç¤ºäº†)
            if (v.name.includes("è¼ªç‹€") && currentChildMonths > 8) return;

            if (currentChildMonths >= v.month) {
                // å·²é”æ–½æ‰“å¹´é½¡
                // è‹¥è¶…éæœ€å¤§ç¯„åœ 24å€‹æœˆ(2æ­²) å‰‡ä¸ä¸»å‹•é¡¯ç¤ºï¼Œé™¤éæ˜¯å…¥å­¸å‰ç–«è‹—
                if ((currentChildMonths - v.month < 24) || v.month >= 60 || (v.type==='self' && currentChildMonths < v.range[1])) {
                    due.push(v);
                }
            } else if (v.month > currentChildMonths && v.month <= currentChildMonths + 6) {
                upcoming.push(v);
            }
        });

        // æ’åºï¼šè‡ªè²»æ’å‰é¢æˆ–å¾Œé¢? æ··åˆæ’æ¯”è¼ƒå¥½ï¼Œä¾æœˆé½¡
        due.sort((a,b) => a.month - b.month);
        upcoming.sort((a,b) => a.month - b.month);

        if (due.length > 0) {
            html += `<h3>ğŸš¨ æœ¬æ¬¡å°±é†«è©•ä¼°é …ç›®</h3>`;
            due.forEach(v => {
                let badgeClass = v.type === 'public' ? 'public' : 'self';
                let cardClass = v.type === 'public' ? 'status-due' : 'status-self';
                let badgeText = v.type === 'public' ? 'å…¬è²»æ‡‰æ‰“' : 'è‡ªè²»å»ºè­°';
                
                html += renderCard(v.name, v.desc, badgeText, badgeClass, cardClass);
            });
        } else {
            html += `<div style="text-align:center; padding:20px; color:#28a745;">âœ… ç›®å‰ç„¡å»ºè­°æ–½æ‰“é …ç›®</div>`;
        }

        if (upcoming.length > 0) {
            html += `<h3 style="margin-top:20px; color:#28a745">ğŸ”œ æœªä¾†åŠå¹´é å‘Š</h3>`;
            upcoming.forEach(v => {
                html += renderCard(v.name, v.desc, `é è¨ˆ${v.month - currentChildMonths}å€‹æœˆå¾Œ`, "upcoming", "status-upcoming");
            });
        }
        resDiv.innerHTML = html;
    }

    // ================= æˆäººé‚è¼¯ (ç¶­æŒä¸è®Š) =================
    function queryAdultVaccines() {
        const age = parseInt(document.getElementById('adultAge').value);
        if (isNaN(age)) { alert("è«‹è¼¸å…¥å¹´é½¡"); return; }
        const isPreg = document.getElementById('pregnant').checked;
        const isHighRisk = document.getElementById('highRisk').checked;
        const isMed = document.getElementById('medicalStaff').checked;
        const history = document.getElementById('pneumoHistory').value;
        let list = [];

        list.push({ name: "æµæ„Ÿç–«è‹—", desc: "å…¨æ°‘é–‹æ‰“ä¸­ (è‡³ç–«è‹—ç”¨ç½„)", tag: "å­£ç¯€æ€§" });

        if (age >= 65 || (age >= 19 && isHighRisk)) {
            let advice = "";
            let eligible = false;
            if (history === 'none') { advice = "å»ºè­°æ¥ç¨® 1 åŠ‘ <span class='highlight'>PCV20 æˆ– PCV21</span>ã€‚"; eligible = true; }
            else if (history === 'ppv23') { advice = "æ›¾æ‰“éPPV23ï¼šéœ€é–“éš”è‡³å°‘1å¹´ï¼Œæ¥ç¨® 1 åŠ‘ PCV20/21ã€‚"; eligible = true; }
            else if (history === 'pcv13') { advice = "æ›¾æ‰“éPCV13/15ï¼šéœ€é–“éš”è‡³å°‘1å¹´ï¼Œæ¥ç¨® 1 åŠ‘ PCV20/21ã€‚"; eligible = true; }
            else { advice = "å·²å®Œæˆå®Œæ•´æ¥ç¨®ã€‚"; }

            if (eligible) list.push({ name: "è‚ºç‚éˆçƒèŒ (PCV20/21)", desc: `<strong>2026æ–°åˆ¶ï¼š</strong>${advice}`, tag: "å»ºè­°æ¥ç¨®" });
        }

        if (isPreg) list.push({ name: "Tdap (ç ´å‚·é¢¨/ç™¾æ—¥å’³)", desc: "æ‡·å­•28-36é€±æ¥ç¨®1åŠ‘ã€‚", tag: "å­•å©¦å°ˆç”¨" });
        if (isMed) list.push({ name: "MMR / Bè‚", desc: "ç¢ºèªæŠ—é«”ç‹€æ³ï¼Œä¸è¶³å»ºè­°è£œç¨®ã€‚", tag: "é†«äº‹äººå“¡" });

        const resDiv = document.getElementById('adultResult');
        let html = "<h3>ğŸ” æŸ¥è©¢çµæœ</h3>";
        list.forEach(v => {
            html += renderCard(v.name, v.desc, v.tag, "adult", "status-adult-rec");
        });
        resDiv.innerHTML = html;
    }

    function renderCard(title, desc, badgeText, badgeClass, cardClass) {
        return `
            <div class="vaccine-card ${cardClass}">
                <div class="v-title">
                    ${title}
                    <span class="badge ${badgeClass}">${badgeText}</span>
                </div>
                <div class="v-desc">${desc}</div>
            </div>
        `;
    }
</script>

</body>
</html>
